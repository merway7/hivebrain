---
interface Props {
  query?: string;
}

const { query = '' } = Astro.props;
---

<form class="search-container" action="/" method="GET">
  <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
  </svg>
  <input
    class="search-input"
    type="text"
    name="q"
    placeholder="Search entries, tags, categories..."
    value={query}
    autocomplete="off"
    id="search-input"
  />
  <span class="search-shortcut">/</span>
</form>

<script>
  document.addEventListener('keydown', (e) => {
    const input = document.getElementById('search-input') as HTMLInputElement;
    if (!input) return;
    if (e.key === '/' && document.activeElement !== input && document.activeElement?.tagName !== 'INPUT') {
      e.preventDefault();
      input.focus();
    }
    if (e.key === 'Escape') {
      input.blur();
    }
  });
</script>

<style is:global>
  .search-container {
    position: relative;
    margin-bottom: 28px;
  }

  .search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    width: 16px;
    height: 16px;
    color: var(--text-dim);
    pointer-events: none;
  }

  .search-input {
    width: 100%;
    font-family: var(--font-mono);
    font-size: 13px;
    color: var(--text-primary);
    background: var(--bg-input);
    border: 1px solid var(--border);
    padding: 11px 14px 11px 40px;
    border-radius: var(--radius-md);
    outline: none;
    transition: all 0.15s ease;
  }

  .search-input::placeholder {
    color: var(--text-dim);
  }

  .search-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-glow);
  }

  .search-input:focus ~ .search-shortcut {
    display: none;
  }

  .search-shortcut {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--text-dim);
    background: var(--bg-overlay);
    border: 1px solid var(--border);
    padding: 2px 6px;
    border-radius: 3px;
    pointer-events: none;
  }
</style>
